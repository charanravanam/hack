<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hack Me By Charan — Chat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --navbar-height:56px;
      --inputbar-height:72px;
      --max-width:650px;
      --bg: #010107;
      --accent: #39ff14;
      --muted: #8aa0b0;
      --mono:'Fira Mono','Hack','IBM Plex Mono',Menlo,monospace;
    }
    html, body {
      min-height: 100vh;
      height: 100vh;
      width: 100vw;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #030d13 0%, var(--bg) 56%);
      font-family: Inter, system-ui, sans-serif;
      color: #e6f2ff;
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
    }
    body::after {
      content:"";position:fixed;inset:0;z-index:0;
      background-image:radial-gradient(rgba(255,255,255,0.02) 1.5px, transparent 1.5px);
      background-size:5px 5px;
      mix-blend-mode:overlay;
      pointer-events:none;
    }
    .navbar {
      height: var(--navbar-height);
      width: 100vw;
      position: fixed;
      top: 0; left: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      background: rgba(0,0,0,0.23);
      border-bottom: 1.2px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
    }
    .navbar-title{
      font-size:19px;font-weight:800;letter-spacing:0.3px;
      color:var(--accent);font-family:var(--mono);margin-left:2px;
    }
    .chat-root {
      display: flex;
      flex-direction: column;
      max-width: var(--max-width);
      width: 100vw;
      margin: 0 auto;
      box-sizing: border-box;
      height: calc(100vh - var(--navbar-height) - var(--inputbar-height));
      margin-top: var(--navbar-height);
      background: rgba(0,0,0,0.07);
      overflow: hidden;
      position: relative;
    }
    .chat-header-bar {
      font-family: var(--mono); color: #39ff14;
      font-size: 1.08em;
      font-weight: 600;
      background: linear-gradient(90deg,#191d3a 30%, #012a17 100%);
      border-radius: 12px 12px 0 0;
      margin-bottom: 0;
      display: flex; align-items: center;
      justify-content: space-between;
      padding: .6em 1.2em;
      letter-spacing: 0.02em;
      border-bottom: 1px solid #23a3792e;
      gap: 8px;
      min-height: 50px;
      box-sizing: border-box;
    }
    .chat-header-bar span {
      background: #162523; color: #2cff8a;
      font-size: 0.97em;
      border: 1.1px solid #39ff14; border-radius: 7px;
      padding: 2.7px 13px; margin-left: 10px;
      letter-spacing: 1px; font-weight: 700;
    }
    .chat-messages-scroll {
      flex: 1 1 0;
      overflow-y: auto;
      padding: 20px 16px 16px 16px;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: 14px;
      box-sizing: border-box;
      min-height: 0;
      scroll-behavior: smooth;
    }
    .msg {
      max-width: 82%;
      padding: 13px 15px;
      border-radius: 13px;
      font-family: var(--mono);
      font-size: 16px;
      line-height: 1.44;
      word-break: break-word;
      margin-bottom: 1px;
      background: #15231e;
      border: 1.2px solid #2e67bc55;
      color: #c9ffd3;
      box-shadow: 0 1.5px 8px #39ff1412;
      animation: appear 0.18s;
      transition: background 0.2s;
    }
    .msg user { margin-left:auto;background:linear-gradient(118deg,#2e67bc 63%,#39ff14 120%);color:#131b1a;border:1.2px solid #39ff1490;}
    .msg.bot { background: #1c2c19;color: #aefcdb;border:1.2px solid #39ff1450;}
    @keyframes appear{from{opacity:.18;transform:translateY(25px) scale(0.97);}to{opacity:1;transform:none;}}
    .timestamp { font-size: 11px; margin-top: 7px; color: #82ffd0; }
    .chat-input-bar {
      position: fixed;
      left: 0;
      bottom: 0;
      z-index: 20;
      width: 100vw;
      max-width: var(--max-width);
      margin: 0 auto;
      display: flex;
      gap: 11px;
      align-items: center;
      padding: 16px 13px 13px 14px;
      background: linear-gradient(180deg, rgba(0,0,0,0.29), rgba(255,255,255,0.025));
      border-radius: 0;
      box-shadow: 0 -2px 10px #2cff8a13;
      min-height: var(--inputbar-height);
      box-sizing: border-box;
    }
    .prompt {
      font-family: var(--mono); font-size: 15px; color: #39ff14;
      padding: 8px 10px; border-radius: 8px;
      background: rgba(0,0,0,0.27);
      border: 1px solid rgba(44,255,140,0.08);
      font-weight: 600;
      box-shadow: 0 1px 7px #2cff8a14;
      margin-right: 5px;
    }
    .input {
      flex: 1;
      padding: 10px 12px;
      border: 0;
      outline: none;
      background: #161f2c;
      font-family: var(--mono);
      font-size: 16px;
      color: #dcfff4;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .send {
      padding: 9.5px 17px;
      border-radius: 8px;
      border: 0;
      background: linear-gradient(90deg,#39ff14,#00ffd5 80%);
      color: #012a17;
      font-weight: 700;
      cursor: pointer;
      font-size: 15px;
      outline: none;
      box-shadow: 0 1.5px 10px #00ffd530;
      transition: box-shadow 0.12s, background 0.18s;
    }
    .send:active, .send:focus {
      background:linear-gradient(90deg,#00ffd5 50%,#2cff8a 110%);
      color:#04140c;
    }
    .typing{display:inline-block;height:13px}
    .dot-typing{width:8px;height:8px;border-radius:50%;background:var(--muted);display:inline-block;margin:0 2px;opacity:0;animation:blink 1.1s infinite;}
    .dot-typing:nth-child(2){animation-delay:.18s;}
    .dot-typing:nth-child(3){animation-delay:.32s;}
    @keyframes blink{0%{opacity:0.1} 51%{opacity:0.8} 100%{opacity:0.09}}
    @media (max-width:600px) {
      :root{--navbar-height:56px;--inputbar-height:66px;--max-width:100vw;}
      .chat-root{width:100vw;border-radius:0;min-width:0;padding:0;}
      .chat-header-bar{font-size: 1em;min-height:38px;border-radius:0;padding:.57em .4em .43em .5em;}
      .chat-messages-scroll{padding:9px 2px 9px 3px;}
      .msg{font-size:14px;padding:9px 9px;max-width:98%;background:#212a25;color:#e0fff2;}
      .msg.user{background:linear-gradient(120deg,#2e67bc 52%,#39ff14 110%);color:#161a21;}
      .msg.bot{background:#1a2a19;color:#a7fcb5;}
      .chat-input-bar{padding:11px 6px;min-height:58px;border-radius:0;}
      .prompt{font-size:14px;padding:6px 7px;}
      .input{font-size:15px;padding:8px 8px;}
      .send{font-size:14px;padding:8px 9px;}
    }
  </style>
  <script>
    if(!localStorage.getItem("hasAccess")){
      window.location.replace("/index.html");
    }
  </script>
</head>
<body>
<div class="navbar">
  <div class="navbar-title">Project ZeroDay</div>
</div>
<div class="chat-root">
  <div class="chat-header-bar">
    <div><span>Made with Love By Charan.</span></div>
    <span style="margin-left:auto; font-size:1em; color:#00ffd5;"></span>
  </div>
  <div class="chat-messages-scroll" id="chat-messages"></div>
</div>
<form class="chat-input-bar" id="chat-form" autocomplete="off">
  <div class="prompt">&gt;_</div>
  <input id="chat-input" class="input" placeholder="Type your message..." autocomplete="off" />
  <button type="submit" class="send" id="send-btn">SEND</button>
</form>
<script>
const chatMessages = document.getElementById('chat-messages');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');

// Provides correct readable formatting:
function escapeHtml(s){
  return s.replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;");
}
function addBubble(text, who="bot"){
  // Format code blocks first
  let html = text.replace(/``````/g, function(match, code){
    return '<pre style="background:#222e39;color:#eaffee;padding:10px 12px;border-radius:8px;margin:8px 0 5px 0;"><code>'+escapeHtml(code)+'</code></pre>';
  });
  // Replace inline code
  html = html.replace(/`([^`]+)`/g, '<code style="background:#191e28;color:#39ff14;padding:2px 6px;border-radius:7px;">$1</code>');
  // Escape the rest, but don't touch code/pre!
  html = html.replace(/&/g,"&amp;")
             .replace(/</g,"&lt;")
             .replace(/>/g,"&gt;");
  // Restore code/pre tags if they got escaped (rare, but safe)
  html = html.replace(/&lt;pre([\s\S]+?)&gt;/g,'<pre$1>')
             .replace(/&lt;\/pre&gt;/g,'</pre>')
             .replace(/&lt;code([\s\S]+?)&gt;/g,'<code$1>')
             .replace(/&lt;\/code&gt;/g,'</code>');
  // Convert double and single line breaks
  html = html.replace(/\n{3,}/g, "\n\n")
             .replace(/\n\n/g, "<br><br>")
             .replace(/\n/g, "<br>");
  const el = document.createElement("div");
  el.className = "msg " + (who === "user" ? "user" : "bot");
  el.innerHTML = `<div>${html}</div>
                  <div class="timestamp">${who === 'user' ? 'You':'Cyber Bot'} • ${new Date().toLocaleTimeString()}</div>`;
  chatMessages.appendChild(el);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showTyping(){
  const typing = document.createElement("div");
  typing.className = "msg bot";
  typing.innerHTML =
    `<div class="typing">
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
    </div>`;
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return typing;
}
chatForm.onsubmit = async function(e) {
  e.preventDefault();
  const msg = chatInput.value.trim();
  if (!msg) return;
  addBubble(msg,"user");
  chatInput.value = "";
  const typing = showTyping();
  try {
    const res = await fetch('/.netlify/functions/cyber-bot', {
      method: 'POST',
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    typing.remove();
    addBubble(data.reply || "Bot error: no reply.");
  } catch (err) {
    typing.remove();
    addBubble("Bot error: API unreachable.");
  }
};
chatInput.focus();
</script>
</body>
</html>
