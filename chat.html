<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hack Me By Charan — Chat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#010107;
      --accent:#39ff14;
      --muted:#8aa0b0;
      --neon:#00ffd5;
      --mono: 'Fira Mono', 'Hack', 'IBM Plex Mono', Menlo, Monaco, monospace;
    }
    html, body {
      margin:0;height:100%;
      background:linear-gradient(180deg,#030d13 0%,var(--bg) 56%);
      font-family:Inter, system-ui, sans-serif;
      color:#e6f2ff;
      overflow:hidden;
      height: 100%;
    }
    body::after{
      content:"";position:fixed;inset:0;z-index:0;
      background-image:radial-gradient(rgba(255,255,255,0.02) 1.5px, transparent 1.5px);
      background-size:5px 5px;
      mix-blend-mode:overlay;
      pointer-events:none;
    }

    .navbar{
      height:56px;
      display:flex;
      align-items:center;
      justify-content: center;
      padding:0 20px;
      background:rgba(0,0,0,0.23);
      border-bottom:1.2px solid rgba(255,255,255,0.06);
      backdrop-filter:blur(6px);
      position:relative; z-index:2;
    }
    .navbar-title{
      font-size:19px;font-weight:800;letter-spacing:0.3px;
      color:var(--accent);font-family:var(--mono);
      margin-left:2px;
    }

    .app{
      display:flex;flex-direction:column;
      max-width:650px;width:98vw;
      margin:16px auto 0 auto;
      height:calc(100dvh - 48px);
      min-height:480px;
      background:rgba(0,0,0,0.07);
      z-index: 1;
    }

    .chat-panel {
  display: flex;
  flex-direction: column;
  height: 100%; /* Fill parent */
  min-height: 0;
}

    .chat-header-bar {
      font-family: var(--mono); color: #39ff14;
      font-size: 1.07em; font-weight: 600;
      background: linear-gradient(90deg,#191d3a 30%, #012a17 100%);
      border-radius: 10px 10px 6px 6px;
      margin-bottom: 7px;
      display: flex; align-items: center;
      justify-content: space-between;
      padding: .6em 1.2em .5em 1em;
      letter-spacing: 0.02em;
      border-bottom: 1px solid #23a3792e;
      gap: 8px;
    }

    .chat-header-bar span {
      background: #162523; color: #2cff8a; font-size: 0.97em;
      border: 1.1px solid #39ff14; border-radius: 7px;
      padding: 2.7px 13px; margin-left: 10px; letter-spacing: 1px; font-weight: 700;
    }

    .chat {
  flex: 1 1 auto;
  overflow-y: auto;
}
    .msg{
      max-width:82%; padding:12px 15px; border-radius:13px;
      font-family:var(--mono); font-size:15px; line-height:1.47;
      word-break: break-word; margin-bottom:1px; background: #0e1a0f;
      border:1.2px solid #214d2d; color:#b6ffd3;
      box-shadow: 0 1.5px 8px #0DEC8920;
      transition:background 0.2s; animation:appear 0.18s;
    }
    .msg.user{
      margin-left:auto;
      background:linear-gradient(180deg,rgba(44,255,140,0.10),rgba(44,255,140,0.027));
      border:1.2px solid #28ff7590; color:#d3ffe9;
    }
    .msg.bot{
      background:linear-gradient(176deg,rgba(39,255,172,0.03) 4%,rgba(255,255,255,0.03) 95%);
      border:1.2px solid rgba(44,255,140,0.1); color:var(--muted);
    }
    .timestamp{
      font-size:11px; margin-top:7px; color:rgba(170,200,220,0.38);
    }
    @keyframes appear{
      from { opacity:.18; transform:translateY(25px) scale(0.97);}
      to   { opacity:1; transform:none;}
    }

    html, body {
  height: 100dvh;
  margin: 0;
  padding: 0;
  background: linear-gradient(180deg,#030d13 0%, #010107 56%);
  font-family: Inter, system-ui, sans-serif;
  color: #e6f2ff;
  overflow: hidden;
}

.chat-root {
  display: flex;
  flex-direction: column;
  height: 100dvh;
  max-width: 650px;
  margin: 0 auto;
  position: relative;
  background: rgba(0,0,0,0.07);
}

.chat-header-bar {
  font-family: 'Fira Mono', 'Hack', monospace;
  color: #39ff14;
  font-size: 1.1em;
  font-weight: 600;
  background: linear-gradient(90deg,#191d3a 30%, #012a17 100%);
  border-radius: 14px 14px 0 0;
  padding: .6em 1.3em;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  border-bottom: 1px solid #23a3792e;
  height: 54px;
  min-height: 54px;
  box-sizing: border-box;
}

/* Scrollable chat area above input bar */
.chat-messages-scroll {
  flex: 1 1 0;
  overflow-y: auto;
  padding: 16px 11px 12px 11px;
  background: transparent;
  display: flex;
  flex-direction: column;
  gap: 14px;
  box-sizing: border-box;
  min-height: 0;
}

/* Individual chat bubbles */
.msg {
  max-width: 82%;
  padding: 12px 15px;
  border-radius: 13px;
  font-family: 'Fira Mono', monospace;
  font-size: 15px;
  line-height: 1.47;
  word-break: break-word;
  margin-bottom: 1px;
  background: #0e1a0f;
  border: 1.2px solid #214d2d;
  color: #b6ffd3;
  box-shadow: 0 1.5px 8px #0DEC8920;
  animation: appear 0.18s;
  transition: background 0.2s;
}
.msg.user { margin-left:auto;background:linear-gradient(180deg,rgba(44,255,140,0.10),rgba(44,255,140,0.027));border:1.2px solid #28ff7590;color:#d3ffe9;}
.msg.bot { background:linear-gradient(176deg,rgba(39,255,172,0.03),rgba(255,255,255,0.03));border:1.2px solid rgba(44,255,140,0.1);color:#8aa0b0;}

@keyframes appear{from{opacity:.18;transform:translateY(25px) scale(0.97);}to{opacity:1;transform:none;}}

.timestamp { font-size: 11px; margin-top: 7px; color: rgba(170,200,220,0.38); }

/* Fixed bottom input bar */
.chat-input-bar {
  display: flex;
  gap: 11px;
  align-items: center;
  padding: 14px 15px 13px 15px;
  background: linear-gradient(180deg, rgba(0,0,0,0.29), rgba(255,255,255,0.025));
  border-radius: 0 0 14px 14px;
  box-shadow: 0 -2px 10px #2cff8a13;
  position: sticky;
  bottom: 0;
  width: 100%;
  min-height: 64px;
}

.prompt {
  font-family: 'Fira Mono', monospace;
  font-size: 15px;
  color: #39ff14;
  padding: 8px 10px;
  border-radius: 8px;
  background: rgba(0,0,0,0.27);
  border: 1px solid rgba(44,255,140,0.08);
  font-weight: 600;
  box-shadow: 0 1px 7px #2cff8a14;
  margin-right: 5px;
}

.input {
  flex: 1;
  padding: 10px 12px;
  border: 0;
  outline: none;
  background: transparent;
  font-family: 'Fira Mono', monospace;
  font-size: 16px;
  color: #e8ffec;
  border-radius: 8px;
  box-sizing: border-box;
}

.send {
  padding: 10px 17px;
  border-radius: 8px;
  border: 0;
  background: linear-gradient(90deg,#39ff14,#00ffd5 80%);
  color: #012a17;
  font-weight: 700;
  cursor: pointer;
  font-size: 15px;
  outline: none;
  box-shadow: 0 1.5px 10px #00ffd530;
  transition: box-shadow 0.12s, background 0.18s;
}

/* Responsive fixes */
@media (max-width:700px) {
  .chat-root {width:100vw;height:100dvh;max-width:100vw;}
  .chat-messages-scroll {padding: 12px 4px 10px 4px;}
  .chat-header-bar, .chat-input-bar {border-radius:0;}
}


    .cmdline {
  display: flex;
  gap: 9px;
  padding: 14px 13px 12px 12px;
  background: linear-gradient(180deg, rgba(0,0,0,0.29), rgba(255,255,255,0.025));
  border-radius: 12px;
  align-items: center;
  box-shadow: 0 -2px 10px #2cff8a15;
  margin-top: 0;
  z-index: 1;

      .app, .chat-panel {
  height: 100vh;
  min-height: 100vh;
  box-sizing: border-box;
}


  /* Key fix for sticky bottom */
  position: sticky;
  bottom: 0; /* Anchors form to bottom of scroll container */
  left: 0;
  width: 100%;
}

    .prompt{
      font-family:var(--mono); font-size:15px;color:var(--accent); padding:8px 10px;
      border-radius:7px; background:rgba(0,0,0,0.27);
      border:1px solid rgba(44,255,140,0.08); letter-spacing: 0.02em; font-weight:600; box-shadow: 0 1px 7px #2cff8a16;
    }
    #chat-input{
      flex:1; padding:9.7px 10px; border:0;outline:none;background:transparent;
      font-family:var(--mono);font-size:16px;color:#e8ffec; border-radius:8px;
    }
    #send-btn{
      padding:10px 17px; border-radius:8px; border:0;
      background:linear-gradient(90deg,var(--accent),#00ffd5 80%);
      color:#012a17; font-weight:700; cursor:pointer; font-size:15px;
      outline:none;transition:box-shadow 0.13s, background 0.19s; box-shadow: 0 1.5px 10px #00ffd530;
    }
    #send-btn:active, #send-btn:focus {
      background:linear-gradient(90deg,#00ffd5 50%,#2cff8a 110%);
      color:#04140d;
    }
    .typing{display:inline-block;height:13px}
    .dot-typing{width:8px;height:8px;border-radius:50%;background:var(--muted);display:inline-block;margin:0 2px;opacity:0;animation:blink 1.1s infinite;}
    .dot-typing:nth-child(2){animation-delay:.18s;}
    .dot-typing:nth-child(3){animation-delay:.32s;}
    @keyframes blink{0%{opacity:0.1} 51%{opacity:0.8} 100%{opacity:0.09}}

    @media (max-width:700px) {
      .app{margin:0;width:100vw;max-width:100vw;height:calc(100dvh - 49px);}
      .chat-panel{padding:2.3vw;}
      .chat-header-bar{padding:.7em .8em .6em .85em;font-size:1em;}
    }
    @media (max-width:400px) {
      .chat-header-bar{font-size:0.89em;}
      .cmdline {padding-left: 7px; padding-right: 7px;}
    }
  </style>
  <script>
    // Require access token gating
    if(!localStorage.getItem("hasAccess")){
      window.location.replace("/index.html");
    }
  </script>
</head>
<body>
<div class="navbar">
  <div class="navbar-title">root@hustle:/Charan Hacks</div>
</div>
<div class="app">
  <section class="chat-panel">
    <div class="chat-header-bar">...</div>
    <div class="chat" id="chat-messages"></div>
    <form class="cmdline" id="chat-form" autocomplete="off">
      <div class="prompt">&gt;_</div>
      <input id="chat-input" class="input" placeholder="Type your message..." autocomplete="off" />
      <button type="submit" class="send" id="send-btn">SEND</button>
    </form>
  </section>
</div>

  <div class="chat-root">
  <div class="chat-header-bar">
    <div><span>Hacker</span></div>
    <span style="margin-left:auto; font-size:1em; color:#00ffd5;">Cyber Bot</span>
  </div>
  <div class="chat-messages-scroll" id="chat-messages"></div>
  <form class="chat-input-bar" id="chat-form" autocomplete="off">
    <div class="prompt">&gt;_</div>
    <input id="chat-input" class="input" placeholder="Type your message..." autocomplete="off" />
    <button type="submit" class="send" id="send-btn">SEND</button>
  </form>
</div>


<script>
const chatMessages = document.getElementById('chat-messages');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');

// Escape HTML for safe display
function escapeHtml(s){
  return s.replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;");
}

// Add a chat bubble message
function addBubble(text, who="bot"){
  const el = document.createElement("div");
  el.className = "msg " + (who === "user" ? "user" : "bot");
  el.innerHTML = `<div>${escapeHtml(text)}</div>
                  <div class="timestamp">${who === 'user' ? 'You':'Cyber Bot'} • ${new Date().toLocaleTimeString()}</div>`;
  chatMessages.appendChild(el);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Show typing indicator
function showTyping(){
  const typing = document.createElement("div");
  typing.className = "msg bot";
  typing.innerHTML =
    `<div class="typing">
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
    </div>`;
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return typing;
}

// Main send logic (user + backend bot reply)
chatForm.onsubmit = async function(e) {
  e.preventDefault();
  const msg = chatInput.value.trim();
  if (!msg) return;
  addBubble(msg,"user");         // add user bubble
  chatInput.value = "";
  const typing = showTyping();   // show "bot is typing..."
  // Call Gemini API backend
  try {
    const res = await fetch('/.netlify/functions/cyber-bot', {
      method: 'POST',
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    typing.remove();              // remove typing indicator
    addBubble(data.reply || "Bot error: no reply.");
  } catch (err) {
    typing.remove();
    addBubble("Bot error: API unreachable.");
  }
};

// Focus is set for instant use
chatInput.focus();
</script>
</body>
</html>
