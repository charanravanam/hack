<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hack Me By Charan — Chat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #010107;
      --accent: #39ff14;
      --muted: #8aa0b0;
      --mono: 'Fira Mono', 'Hack', 'IBM Plex Mono', Menlo, Monaco, monospace;
      --navbar-height: 56px;
      --inputbar-height: 72px;
      --max-width: 650px;
      --bubble-radius: 16px;
    }
    html, body {
      min-height: 100dvh;
      height: 100dvh;
      width: 100vw;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg,#030d13 0%, var(--bg) 56%);
      font-family: Inter, system-ui, sans-serif;
      color: #e6f2ff;
      box-sizing: border-box;
      overflow: hidden;
    }
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      z-index: 0;
      background-image: radial-gradient(rgba(255,255,255,0.02) 1.5px, transparent 1.5px);
      background-size: 5px 5px;
      mix-blend-mode: overlay;
      pointer-events: none;
    }

    .navbar {
      height: var(--navbar-height);
      width: 100vw;
      position: fixed;
      top: 0; left: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      background: #1d2236;
      border-bottom: 1.2px solid rgba(255,255,255,0.09);
      backdrop-filter: blur(8px);
      box-sizing: border-box;
    }
    .navbar-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.3px;
      color: var(--accent);
      font-family: var(--mono);
      margin-left: 2px;
    }
    .chat-root {
      display: flex;
      flex-direction: column;
      max-width: var(--max-width);
      width: 100vw;
      position: relative;
      margin: 0 auto;
      box-sizing: border-box;
      height: calc(100dvh - var(--navbar-height) - var(--inputbar-height));
      margin-top: var(--navbar-height);
      margin-bottom: var(--inputbar-height);
      background: rgba(0,0,0,0.07);
      overflow: hidden;
      border-radius: 0;
    }
    .chat-header-bar {
      font-family: var(--mono);
      color: #39ff14;
      font-size: 1.1em;
      font-weight: 600;
      background: #181c39;
      border-radius: 18px 18px 0 0;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85em 1.2em 0.7em 1.2em;
      letter-spacing: 0.02em;
      border-bottom: 1px solid #23a3792e;
      gap: 8px;
      min-height: 44px;
      box-sizing: border-box;
    }
    .chat-header-bar span {
      background: #162523;
      color: #2cff8a;
      font-size: 0.97em;
      border: 1.1px solid #39ff14;
      border-radius: 7px;
      padding: 3px 14px;
      margin-left: 10px;
      letter-spacing: 1px;
      font-weight: 700;
    }
    .chat-messages-scroll {
      flex: 1 1 0;
      overflow-y: auto;
      padding: 22px 10px 22px 12px;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-sizing: border-box;
      min-height: 0;
      scroll-behavior: smooth;
      height: 100%;
    }
    .msg {
      max-width: 90%;
      padding: 15px 18px;
      border-radius: var(--bubble-radius);
      font-family: var(--mono);
      font-size: 17px;
      line-height: 1.46;
      word-break: break-word;
      margin-bottom: 1px;
      background: #181f24;
      border: 1.3px solid #222e39;
      color: #f2f7ff;
      box-shadow: 0 1.5px 10px #1f2840a6;
      animation: appear 0.18s;
      transition: background 0.2s;
      white-space: pre-wrap;
    }
    .msg.user {
      margin-left: auto;
      background: #39ff14;
      color: #08170e;
      border: 1.2px solid #2cff8a;
      font-weight: 700;
      box-shadow: 0 2px 18px #1fefc5a0, 0 1px 4px #181f24;
      text-align: left;
    }
    .msg.bot {
      background: #222e39;
      color: #c8ffc7;
      border: 1.2px solid #39ff144a;
      font-weight: 550;
      text-align: left;
    }
    @keyframes appear {
      from { opacity: .12; transform: translateY(24px) scale(0.98); }
      to { opacity: 1; transform: none; }
    }
    .timestamp {
      font-size: 13px;
      margin-top: 7px;
      color: #67c397;
      font-weight: 400;
    }
    .chat-input-bar {
      position: fixed;
      left: 0;
      bottom: 0;
      z-index: 20;
      width: 100vw;
      max-width: var(--max-width);
      margin: 0 auto;
      display: flex;
      gap: 9px;
      align-items: center;
      padding: 14px 13px 14px 13px;
      background: #f7fdff;
      border-top: 1.8px solid #24272f27;
      box-shadow: 0 -2px 16px #39ff140c;
      min-height: var(--inputbar-height);
      box-sizing: border-box;
      border-radius: 0 0 10px 10px;
    }
    .prompt {
      font-family: var(--mono);
      font-size: 18px;
      color: #39ff14;
      padding: 9px 11px;
      border-radius: 8px;
      background: #e6ffe9;
      border: 1px solid #39ff14;
      font-weight: 700;
      margin-right: 3px;
    }
    .input {
      flex: 1;
      padding: 12px 12px;
      border: 0;
      outline: none;
      background: #fff;
      font-family: var(--mono);
      font-size: 18px;
      color: #25292f;
      border-radius: 9px;
      box-sizing: border-box;
      font-weight: 600;
      margin-right: 2px;
    }
    .send {
      padding: 10px 17px;
      border-radius: 9px;
      border: 0;
      background: linear-gradient(90deg,#39ff14,#00ffd5 80%);
      color: #012a17;
      font-weight: 900;
      cursor: pointer;
      font-size: 17px;
      outline: none;
      box-shadow: 0 2px 12px #39ff1423;
      transition: box-shadow 0.12s, background 0.18s;
      letter-spacing: 0.5px;
    }
    .send:active, .send:focus {
      background: linear-gradient(90deg,#00ffd5 50%,#2cff8a 110%);
      color: #012a17;
    }
    .typing{
      display:inline-block;
      height:13px;
      margin-top:3px;
    }
    .dot-typing{
      width:8px; height:8px; border-radius:50%;
      background:#8aa0b0;
      display:inline-block;
      margin:0 2px;
      opacity:0;
      animation:blink 1.1s infinite;
    }
    .dot-typing:nth-child(2){animation-delay:.14s;}
    .dot-typing:nth-child(3){animation-delay:.28s;}
    @keyframes blink{0%{opacity:0.1} 51%{opacity:0.75} 100%{opacity:0.09}}
    @media (max-width:600px) {
      :root{
        --navbar-height:56px;
        --inputbar-height:66px;
        --max-width:100vw;
      }
      .chat-root {
        width:100vw; border-radius:0;
        min-width:0;
        padding:0;
      }
      .chat-header-bar {
        font-size: 1em; min-height:38px;
        border-radius:0; padding:.57em .4em .43em .5em;
      }
      .chat-messages-scroll {padding:8px 2px 8px 4px;}
      .msg {font-size: 16px; padding:11px 10px; max-width:98%; border-radius:13px;}
      .msg.user {background:#39ff14; color:#062d0c;}
      .msg.bot {background:#212941; color:#bff7d3;}
      .chat-input-bar {padding:12px 7px; min-height:66px; border-radius:0;}
      .prompt {font-size:17px; padding:6px 6px;}
      .input {font-size:17px; padding:8px 8px;}
      .send {font-size:16px; padding:8px 12px;}
    }
    @media (max-width:400px) {
      .chat-header-bar{font-size:0.95em;}
      .chat-input-bar {padding:9px 2px;}
      .msg {font-size:15px; padding:8px 6px;}
      .prompt {font-size:16px; padding:4px 4px;}
      .send {font-size:15px; padding:6px 8px;}
    }
  </style>
  <script>
    // Secure access gating
    if(!localStorage.getItem("hasAccess")){
      window.location.replace("/index.html");
    }
  </script>
</head>
<body>
<div class="navbar">
  <div class="navbar-title">root@hustle:/Charan Hacks</div>
</div>
<div class="chat-root">
  <div class="chat-header-bar">
    <div><span>Hacker</span></div>
    <span style="margin-left:auto; font-size:1em; color:#00ffd5;">Cyber Bot</span>
  </div>
  <div class="chat-messages-scroll" id="chat-messages"></div>
</div>
<form class="chat-input-bar" id="chat-form" autocomplete="off">
  <div class="prompt">&gt;_</div>
  <input id="chat-input" class="input" placeholder="Type your message..." autocomplete="off" />
  <button type="submit" class="send" id="send-btn">SEND</button>
</form>
<script>
const chatMessages = document.getElementById('chat-messages');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');

function escapeHtml(s){
  return s.replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;");
}
function addBubble(text, who="bot"){
  const el = document.createElement("div");
  el.className = "msg " + (who === "user" ? "user" : "bot");
  el.innerHTML = `<div>${escapeHtml(text)}</div>
                  <div class="timestamp">${who === 'user' ? 'You':'Cyber Bot'} • ${new Date().toLocaleTimeString()}</div>`;
  chatMessages.appendChild(el);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function showTyping(){
  const typing = document.createElement("div");
  typing.className = "msg bot";
  typing.innerHTML =
    `<div class="typing">
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
    </div>`;
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return typing;
}
chatForm.onsubmit = async function(e) {
  e.preventDefault();
  const msg = chatInput.value.trim();
  if (!msg) return;
  addBubble(msg,"user");
  chatInput.value = "";
  const typing = showTyping();
  try {
    const res = await fetch('/.netlify/functions/cyber-bot', {
      method: 'POST',
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    typing.remove();
    addBubble(data.reply || "Bot error: no reply.");
  } catch (err) {
    typing.remove();
    addBubble("Bot error: API unreachable.");
  }
};
chatInput.focus();
</script>
</body>
</html>
